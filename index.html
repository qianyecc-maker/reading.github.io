<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KET å¬å†™ç»ƒä¹ </title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin: 10px;
      cursor: pointer;
    }
    #bookList, #dictationArea {
      margin-top: 20px;
      padding: 15px;
      background: white;
      border-radius: 8px;
      display: none;
    }
  </style>
</head>
<body>

<h1>KET å¬å†™å·¥å…·</h1>
<button id="btnSelectBook">ğŸ“š é€‰æ‹©è¯ä¹¦</button>
<button id="btnStart">ğŸ§ å¼€å§‹å¬å†™</button>

<div id="bookList"></div>
<div id="dictationArea">å¬å†™åŒºåŸŸ...</div>

<script>
  let vocabularyData = null;

  // åŠ è½½è¯åº“
  async function loadVocabulary() {
    try {
      const response = await fetch('./ket-vocabulary.json');
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      const text = await response.text();
      // æ£€æŸ¥æ˜¯å¦åŒ…å« BOMï¼ˆéšè—å­—ç¬¦ï¼‰
      if (text.charCodeAt(0) === 0xFEFF) {
        console.warn('æ£€æµ‹åˆ° BOMï¼Œå·²è‡ªåŠ¨ç§»é™¤');
      }
      vocabularyData = JSON.parse(text.trim().replace(/^\uFEFF/, ''));
      console.log('âœ… è¯åº“åŠ è½½æˆåŠŸ:', vocabularyData);
      showBookList();
    } catch (err) {
      console.error('âŒ è¯åº“åŠ è½½å¤±è´¥:', err);
      alert('âš ï¸ è¯åº“åŠ è½½å¤±è´¥ï¼\nè¯·ç¡®ä¿ ket-vocabulary.json æ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®ã€‚\né”™è¯¯ä¿¡æ¯ï¼š' + err.message);
    }
  }

  function showBookList() {
    const bookList = document.getElementById('bookList');
    bookList.innerHTML = '<h3>é€‰æ‹©ä¸»é¢˜ï¼š</h3>';
    vocabularyData.forEach((book, index) => {
      const btn = document.createElement('button');
      btn.textContent = book.name;
      btn.onclick = () => startDictation(book.words);
      bookList.appendChild(btn);
    });
    bookList.style.display = 'block';
  }

  function startDictation(words) {
    document.getElementById('dictationArea').innerHTML = 
      `<p>å…± ${words.length} ä¸ªå•è¯ï¼Œå¼€å§‹å¬å†™ï¼</p><p>ç¤ºä¾‹ï¼š${words.slice(0, 3).join(', ')}</p>`;
    document.getElementById('dictationArea').style.display = 'block';
  }

  // ç»‘å®šæŒ‰é’®
  document.getElementById('btnSelectBook').addEventListener('click', () => {
    if (!vocabularyData) {
      loadVocabulary();
    } else {
      document.getElementById('bookList').style.display = 'block';
    }
  });

  document.getElementById('btnStart').addEventListener('click', () => {
    if (!vocabularyData) {
      alert('è¯·å…ˆé€‰æ‹©è¯ä¹¦ï¼');
      loadVocabulary();
    } else {
      // é»˜è®¤ç”¨ç¬¬ä¸€ä¸ªä¸»é¢˜å¼€å§‹
      startDictation(vocabularyData[0].words);
    }
  });
</script>

</body>
</html>
