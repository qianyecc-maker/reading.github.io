<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KET å¬å†™ç»ƒä¹ </title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f8f9fa;
      padding: 20px;
      margin: 0;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .btn {
      padding: 12px 24px;
      font-size: 18px;
      margin: 10px 5px;
      cursor: pointer;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      transition: background 0.2s;
    }
    .btn:hover {
      background: #0069d9;
    }
    #bookList, #dictationArea {
      margin-top: 24px;
      padding: 16px;
      background: #f1f8ff;
      border-radius: 8px;
      display: none;
    }
    #bookList h3 {
      margin-top: 0;
      color: #007bff;
    }
    #bookList button {
      margin: 6px;
      padding: 8px 16px;
      font-size: 16px;
    }
    #dictationArea p {
      line-height: 1.6;
    }
    .error {
      color: #dc3545;
      background: #f8d7da;
      padding: 10px;
      border-radius: 6px;
      margin-top: 10px;
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“˜ KET å¬å†™ç»ƒä¹ å·¥å…·</h1>
    
    <button id="btnSelectBook" class="btn">ğŸ“š é€‰æ‹©è¯ä¹¦</button>
    <button id="btnStart" class="btn">ğŸ§ å¼€å§‹å¬å†™</button>
    
    <div id="errorMessage" class="error"></div>

    <div id="bookList"></div>
    <div id="dictationArea"></div>
  </div>

  <script>
    // å…¨å±€å˜é‡ï¼šå­˜å‚¨åŠ è½½çš„è¯åº“æ•°æ®
    let vocabularyData = null;

    // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
    function showError(msg) {
      const el = document.getElementById('errorMessage');
      el.textContent = 'âš ï¸ ' + msg;
      el.style.display = 'block';
      setTimeout(() => el.style.display = 'none', 5000);
    }

    // åŠ è½½è¯åº“
    async function loadVocabulary() {
      try {
        const response = await fetch('./ket-vocabulary.json');
        if (!response.ok) {
          throw new Error(`åŠ è½½å¤±è´¥ï¼šHTTP ${response.status}`);
        }
        const data = await response.json();
        if (!Array.isArray(data)) {
          throw new Error('è¯åº“æ ¼å¼é”™è¯¯ï¼šåº”ä¸ºæ•°ç»„');
        }
        if (data.length === 0) {
          throw new Error('è¯åº“ä¸ºç©º');
        }
        vocabularyData = data; // âœ… èµ‹å€¼ç»™å…¨å±€å˜é‡
        showBookList();
      } catch (err) {
        console.error('åŠ è½½è¯åº“å‡ºé”™:', err);
        showError(err.message || 'æœªçŸ¥é”™è¯¯');
      }
    }

    // æ˜¾ç¤ºè¯ä¹¦åˆ—è¡¨
    function showBookList() {
      const bookList = document.getElementById('bookList');
      bookList.innerHTML = '<h3>ğŸ“– è¯·é€‰æ‹©ä¸€ä¸ªä¸»é¢˜ï¼š</h3>';
      vocabularyData.forEach(book => {
        if (!book.name || !Array.isArray(book.words)) return;
        const btn = document.createElement('button');
        btn.className = 'btn';
        btn.textContent = book.name + ` (${book.words.length})`;
        btn.onclick = () => startDictation(book.words, book.name);
        bookList.appendChild(btn);
      });
      bookList.style.display = 'block';
    }

    // å¼€å§‹å¬å†™
    function startDictation(words, name = 'è¯ä¹¦') {
      const area = document.getElementById('dictationArea');
      area.innerHTML = `
        <h3>ğŸ§ æ­£åœ¨å¬å†™ï¼š${name}</h3>
        <p>å…± <strong>${words.length}</strong> ä¸ªå•è¯ã€‚</p>
        <p>å‰å‡ ä¸ªå•è¯ç¤ºä¾‹ï¼š<code>${words.slice(0, Math.min(5, words.length)).join(', ')}</code></p>
        <p>ï¼ˆå®é™…å¬å†™åŠŸèƒ½å¯åœ¨æ­¤å¤„æ‰©å±•ï¼‰</p>
      `;
      area.style.display = 'block';
    }

    // ç»‘å®šæŒ‰é’®äº‹ä»¶
    document.getElementById('btnSelectBook').addEventListener('click', () => {
      if (!vocabularyData) {
        loadVocabulary();
      } else {
        document.getElementById('bookList').style.display = 'block';
      }
    });

    document.getElementById('btnStart').addEventListener('click', () => {
      if (!vocabularyData) {
        showError('è¯·å…ˆåŠ è½½è¯ä¹¦ï¼');
        loadVocabulary();
      } else {
        // é»˜è®¤ä½¿ç”¨ç¬¬ä¸€ä¸ªè¯ä¹¦å¼€å§‹å¬å†™
        const firstBook = vocabularyData[0];
        startDictation(firstBook.words, firstBook.name);
      }
    });
  </script>
</body>
</html>
